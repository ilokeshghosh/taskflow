<core:FragmentDefinition
    xmlns:f="sap.f"
    xmlns="sap.m"
    xmlns:form="sap.ui.layout.form"
    xmlns:core="sap.ui.core"
    xmlns:p13n="sap.m.p13n"
    xmlns:fb="sap.ui.comp.filterbar"
>
    <Panel height="100%">
        <!-- Project Container -->
        <content>
            <Panel width="100%">
                <!-- Project Container Header Tool Bar || TO BE IMPLEMENTED (add search & filter) -->
                <headerToolbar>
                    <OverflowToolbar height="auto">
                        <HBox
                            justifyContent="SpaceBetween"
                            width="100%"
                            alignItems="Center"
                            wrap="Wrap"
                        >
                            <!-- Search and Sort Container -->
                            <HBox
                                gap="1rem"
                                alignItems="Start"
                                width="auto"
                                height="auto"
                            >
                                <SearchField
                                    id="projectSearchField"
                                    placeholder="Search.."
                                    liveChange=".onSearchProjects"
                                />

                                <Button
                                    type="Transparent"
                                    icon="sap-icon://sort"
                                    press="onSorterContainerOpen"
                                    tooltip="Sort"
                                />

                                <p13n:Popup
                                    id="p13nPopup"
                                    title="Project Sort"
                                    close="onClose"
                                    warningText="Are you sure?"
                                >
                                    <p13n:panels>
                                        <p13n:SortPanel
                                            id="sortPanel"
                                            title="Sort"
                                            change="onParseP13nState"
                                        />
                                    </p13n:panels>
                                </p13n:Popup>
                            </HBox>

                            <!-- Filter Container ( status / priority ) -->
                            <HBox
                                width="auto"
                                height="auto"
                            >
                                <fb:FilterBar
                                    id="filterBar"
                                    persistencyKey="myPersistencyKey"
                                    useToolbar="false"
                                    search=".onSearch"
                                >
                                    <fb:filterGroupItems>
                                        <!-- Item 1: Status Filter -->
                                        <fb:FilterGroupItem
                                            name="status"
                                            label="Status"
                                            groupName="Group1"
                                            visibleInFilterBar="true"
                                            id="Group1"
                                        >
                                            <fb:control>
                                                <Select id="statusSelect">
                                                    <items>
                                                        <core:Item
                                                            key="X"
                                                            text="All"
                                                        />
                                                        <core:Item
                                                            key="A"
                                                            text="Planning"
                                                        />
                                                        <core:Item
                                                            key="B"
                                                            text="Hold"
                                                        />
                                                        <core:Item
                                                            key="C"
                                                            text="In Progress"
                                                        />
                                                        <core:Item
                                                            key="D"
                                                            text="Completed"
                                                        />
                                                    </items>
                                                </Select>
                                            </fb:control>
                                        </fb:FilterGroupItem>

                                        <fb:FilterGroupItem
                                            name="priority"
                                            label="Priority"
                                            groupName="Group2"
                                            visibleInFilterBar="true"
                                            id="Group2"
                                        >
                                            <fb:control>
                                                <Select id="prioritySelect">
                                                    <items>
                                                        <core:Item
                                                            key="X"
                                                            text="All"
                                                        />
                                                        <core:Item
                                                            key="A"
                                                            text="High"
                                                        />
                                                        <core:Item
                                                            key="B"
                                                            text="Medium"
                                                        />
                                                        <core:Item
                                                            key="C"
                                                            text="Low"
                                                        />
                                                    </items>
                                                </Select>
                                            </fb:control>
                                        </fb:FilterGroupItem>
                                    </fb:filterGroupItems>
                                </fb:FilterBar>
                            </HBox>
                        </HBox>
                    </OverflowToolbar>
                </headerToolbar>

                <content>
                    <!-- Project Cards Container -->
                    <FlexBox
                        id="projectCardContainer"
                        wrap="Wrap"
                        justifyContent="SpaceAround"
                        width="100%"
                        items="{
                        path:'/Projects',
                        parameters:{
                            $expand:'client'
                        }
                       }"
                        gap="1rem"
                        class="projectOverViewFlex"
                    >
                        <items />
                        <!-- Project Card  -->
                        <f:Card
                            class="projectCard sapUiContentPadding sapUiSmallMarginBottom"
                        >
                            <f:content>
                                <VBox
                                    class="cardContent sapUiTinyMargin"
                                    width="100%"
                                >
                                    <!--UPPER SECTION || Project Title + Desc -->
                                    <HBox
                                        justifyContent="SpaceBetween"
                                        alignItems="Start"
                                        class="cardHeader"
                                        wrap="Wrap"
                                        width="100%"
                                    >
                                        <!-- LEFT : Badge + Title -->
                                        <VBox
                                            class="titleSection"
                                            width="90%"
                                        >
                                            <Title
                                                text="{name}"
                                                level="H5"
                                                class="cardTitle"
                                            />
                                            <Text
                                                text="{description}"
                                                class="cardSubtitle sapUiTinyMarginTop"
                                            />
                                        </VBox>

                                        <!-- RIGHT : Status Badge -->
                                        <ObjectStatus
                                            text="{status}"
                                            state="{path:'status',formatter:'.formatter.formatStatus'}"
                                            class="statusBadge"
                                            inverted="true"
                                        />
                                    </HBox>

                                    <!-- MID SECTION || Project Progress & Project Action Button Container -->
                                    <VBox
                                        class=""
                                        justifyContent="End"
                                    >
                                        <!-- deadline section -->
                                        <HBox
                                            alignItems="Center"
                                            class="deadlineSection sapUiSmallMarginTop"
                                            width="100%"
                                            justifyContent="SpaceBetween"
                                            wrap="Wrap"
                                        >
                                            <HBox gap="2px">
                                                <core:Icon
                                                    src="sap-icon://appointment-2"
                                                    size="1rem"
                                                    color="#666"
                                                    class=""
                                                />

                                                <Text
                                                    text="{deadline}"
                                                    class="deadlineText"
                                                />
                                            </HBox>

                                            <!-- Three dots menu -->

                                            <Button
                                                icon="sap-icon://overflow"
                                                type="Transparent"
                                                press=".onQuickActionMenuPress"
                                            />
                                        </HBox>

                                        <!-- progress section -->
                                        <VBox
                                            class="progressSection "
                                            justifyContent="End"
                                        >
                                            <HBox
                                                justifyContent="SpaceBetween"
                                                alignItems="Center"
                                                class=""
                                            >
                                                <Text
                                                    text="Progress"
                                                    class="progressLabel"
                                                />
                                                <Text
                                                    text="{progress}%"
                                                    class="progressValue"
                                                />
                                            </HBox>

                                            <ProgressIndicator
                                                percentValue="{progress}"
                                                class="progressBar"
                                                width="100%"
                                                displayAnimation="true"
                                                displayOnly="true"
                                            />
                                        </VBox>

                                        <!-- footer section -->
                                        <HBox />
                                    </VBox>

                                    <!-- LOWER SECTION || Project Other Details( Client, Budget, Start Date, Priority) -->
                                    <VBox
                                        class="sapUiMediumMarginTop"
                                        gap="1rem"
                                    >
                                        <!-- client / Budget -->
                                        <HBox
                                            justifyContent="SpaceBetween"
                                            wrap="Wrap"
                                        >
                                            <!-- client -->
                                            <VBox
                                                width="70%"
                                                class=""
                                                gap="5px"
                                            >
                                                <Text text="Client" />
                                                <Title
                                                    text="{client/firstname}"
                                                    level="H4"
                                                />
                                            </VBox>

                                            <!-- Budget -->
                                            <VBox
                                                class=""
                                                width="30%"
                                                gap="5px"
                                            >
                                                <Text text="Budget" />
                                                <Title
                                                    text="${budget}"
                                                    level="H4"
                                                />
                                            </VBox>
                                        </HBox>
                                        <!-- start date / priority -->

                                        <HBox justifyContent="SpaceBetween">
                                            <!-- start date -->
                                            <VBox
                                                width="70%"
                                                class=""
                                                gap="5px"
                                            >
                                                <Text text="Start Date" />
                                                <Title
                                                    text="{startDate}"
                                                    level="H4"
                                                />
                                            </VBox>

                                            <!-- priority -->
                                            <VBox
                                                class=""
                                                width="30%"
                                                gap="5px"
                                            >
                                                <Text text="Priority" />

                                                <ObjectStatus
                                                    state="{path:'priority', formatter:'.formatter.formatPriority'}"
                                                    text="{priority}"
                                                    inverted="true"
                                                />
                                            </VBox>
                                        </HBox>
                                    </VBox>
                                </VBox>
                            </f:content>
                        </f:Card>
                    </FlexBox>
                </content>
            </Panel>
        </content>
    </Panel>
</core:FragmentDefinition>
